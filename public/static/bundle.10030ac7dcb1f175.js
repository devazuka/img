"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[920],{920:(e,r,i)=>{i.a(e,(async(e,n)=>{try{i.d(r,{ImageDebug:()=>p});var t=i(52),c=i.n(t),a=i(937),s=i(994),o=i(245),l=i(8),d=i(270),h=i(201),m=e([d]);async function g(e,r,i){const n=await createImageBitmap(e);i((()=>n.close()));const t=new OffscreenCanvas(n.width,n.height),c=t.getContext("2d");c.drawImage(n,0,0);const a=c.getImageData(0,0,n.width,n.height);let s;t.width=0,t.height=0;try{s=d.EP(r,a.data,n.width,n.height),i((()=>d.WW(s)))}catch(e){console.error("loading original into dssim",e)}return{image:n,di:s}}d=(m.then?(await m)():m)[0];const p=()=>{const[e,r]=(0,s.J0)(void 0),[i,n]=(0,s.J0)([]),t=e=>n((r=>[...r,e])),m={error:e=>t((0,h.FD)(h.FK,{children:["crash: ",JSON.stringify((0,o.P5)(e))]})),warn:e=>t((0,h.FD)(h.FK,{children:["warn: ",e]}))};(0,s.vJ)((()=>{(async()=>{const i=[];try{if(!e)return;const n=e.blob;try{const e=await(0,l.SC)(n);r((r=>r&&{...r,magic:e}))}catch(e){console.error("reading magic",e)}const t=[.9,.8,.7,.5,.3,.1].map((e=>[e,"browser webp at "+(e??"default")]));r((e=>e&&{...e,images:Object.fromEntries(t.map((e=>{let[,r]=e;return[r,{}]})))}));const c=d.vt();i.push((()=>d.t9(c)));const{image:a,di:s}=await g(n,c,(e=>i.push(e)));r((e=>e&&{...e,dims:[a.width,a.height]}));for(const[e,i]of t){const n=performance.now(),t=await(0,l.h8)(a,e),o=performance.now()-n;let h;await u(15);try{const e=[],{image:r,di:i}=await g(t,c,(r=>e.push(r)));r.close();try{h=s&&i&&d.UD(c,s,i)}finally{for(const r of e)r()}}catch(e){console.error(e)}r((e=>e&&{...e,images:{...e.images,[i]:{enc:t,comp:h,elapsed:o}}}))}}catch(e){console.error(e)}finally{for(const e of i)try{e()}catch(e){console.error("cleanup",e)}}})()}),[e?.blob,e?.ctx,e?.alt]);const p=[(0,h.FD)("div",{class:"row",children:[(0,h.Y)("div",{className:"col",children:(0,h.Y)(a._,{printer:m,triggerUploads:(e,i)=>{t((0,h.FD)(h.FK,{children:[e.length," items received from ",i,", using first"]})),r({blob:e[0],alt:[],ctx:i,images:{}})}})}),(0,h.Y)("div",{className:"col",children:(0,h.Y)("p",{children:(0,h.Y)("button",{class:"btn btn-danger",onClick:()=>{r(void 0),n([])},children:"Clear"})})})]}),(0,h.Y)("div",{class:"row",children:(0,h.Y)("div",{className:"col",children:i.map((e=>(0,h.Y)("p",{children:e})))})})];return e&&(p.push((0,h.FD)("div",{class:"row",children:[(0,h.Y)("div",{class:"col",children:(0,h.Y)(v,{image:{enc:e.blob},alt:"original"})}),(0,h.FD)("div",{class:"col",children:[(0,h.FD)("p",{children:["Declared: ",e.blob.type]}),(0,h.FD)("p",{children:["Magic: ",e.magic]}),(0,h.FD)("p",{children:["Dims:"," ",e.dims?(0,h.FD)(h.FK,{children:[e.dims?.[0],"x",e.dims?.[1]]}):"???"]})]})]})),p.push((0,h.Y)("div",{class:"row",children:(0,h.FD)("div",{class:"col",children:[(0,h.Y)("h2",{children:"WebP"}),Object.entries(e.images??{}).map((e=>{let[r,i]=e;return i.enc?(0,h.Y)(h.FK,{children:(0,h.Y)(v,{image:i,alt:r})}):(0,h.FD)("div",{style:{float:"left"},children:[(0,h.Y)(c(),{})," ",r]})}))]})}))),(0,h.Y)("div",{class:"container-fluid",children:p})},f=e=>(0,h.FD)("abbr",{title:e.size.toLocaleString()+" bytes",children:[(e.size/1024/1024).toFixed(2)," MiB"]}),v=e=>{const r=e.image,[i,n]=(0,s.J0)(!1);return(0,h.FD)("div",{children:[(0,h.Y)("img",{src:URL.createObjectURL(r.enc),style:{maxWidth:i?void 0:"500px",cursor:"zoom-in"},onClick:()=>n((e=>!e))}),(0,h.FD)("p",{children:[e.alt,": ",(0,h.Y)(f,{size:r.enc.size})," ",r.comp&&(0,h.FD)(h.FK,{children:[(0,h.Y)("a",{href:"https://github.com/kornelski/dssim",target:"_blank",children:"dssim"})," ","error: ",(100*r.comp).toFixed(6),"%"]}),r.elapsed&&(0,h.FD)(h.FK,{children:[", encoded in ",r.elapsed.toFixed(0),"ms"]})]})]})},u=async e=>new Promise((r=>setTimeout(r,e)));n()}catch(w){n(w)}}))},270:(e,r,i)=>{i.a(e,(async(e,n)=>{try{i.d(r,{EP:()=>o,UD:()=>d,WW:()=>l,t9:()=>s,vt:()=>a});var t=i(28),c=e([t]);t=(c.then?(await c)():c)[0];const a=()=>({__marker:"dssim",inner:t.dssim_new()}),s=e=>{t.dssim_free(e.inner)},o=(e,r,i,n)=>{const c=t.dssim_calloc(r.length);try{const a=new Uint8ClampedArray(t.memory.buffer);for(let e=0;e<r.length;e++)a[c+e]=r[e];return{__marker:"dssim-image",inner:t.dssim_create_image_rgba(e.inner,c,i,n)}}finally{t.dssim_free_calloc(c,r.length)}},l=e=>{t.dssim_free_image(e.inner)},d=(e,r,i)=>t.dssim_compare(e.inner,r.inner,i.inner);n()}catch(e){n(e)}}))},52:(e,r,i)=>{var n=i(172),t=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};e.exports=function(e){var r=e.color,i=void 0===r?"currentColor":r,c=e.size,a=void 0===c?24:c,s=(e.children,function(e,r){var i={};for(var n in e)r.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);return i}(e,["color","size","children"])),o="mdi-icon "+(s.class||s.className||"");return n.h("svg",t({},s,{class:o,width:a,height:a,fill:i,viewBox:"0 0 24 24"}),n.h("path",{d:"M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"}))}},28:(e,r,i)=>{e.exports=i.v(r,e.id,"be394870803fa4d3")}}]);